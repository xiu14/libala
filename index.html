<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Workspace</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="style.css">
    
    <!-- ç™»å½•é¡µä¸“ç”¨æ ·å¼ (ç§»æ¤è‡ª g.html å¹¶é€‚é…ç§»åŠ¨ç«¯) -->
    <style>
        #login-screen {
            background: radial-gradient(circle at 30% 20%, #2a2340, #0c0c16) !important;
            font-family: "Segoe UI", sans-serif;
            color: #ddd;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* ç¡®ä¿è¦†ç›– style.css çš„é»˜è®¤æ ·å¼ */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        /* å›¾ç‰‡ Logo æ ·å¼ */
        .login-logo {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ä¸è¢«æ‹‰ä¼¸ */
            margin-bottom: 20px;
            box-shadow: 0 0 25px rgba(156, 116, 255, 0.4); /* æ·»åŠ ä¸€ç‚¹ç´«è‰²å…‰æ™•å‘¼åº”ä¸»é¢˜ */
            border: 2px solid rgba(156, 116, 255, 0.2);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .login-title-text {
            font-size: 24px;
            margin-bottom: 8px;
            text-align: center;
            padding: 0 20px;
        }

        .login-subtitle {
            opacity: 0.7;
            margin-bottom: 30px;
            font-size: 14px;
            text-align: center;
            padding: 0 20px;
            line-height: 1.5;
        }

        /* è¦†ç›–åŸæœ¬çš„ login-box æ ·å¼ */
        #login-screen .login-box {
            padding: 30px;
            width: 85%; /* ç§»åŠ¨ç«¯é€‚é…ï¼šä½¿ç”¨ç™¾åˆ†æ¯” */
            max-width: 340px; /* é™åˆ¶æœ€å¤§å®½åº¦ */
            background: rgba(255,255,255,0.05) !important;
            backdrop-filter: blur(10px);
            border-radius: 12px;
            position: relative;
            border: none !important;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
        }

        /* å·¦ä¾§äº®çº¿è£…é¥° */
        #login-screen .login-box::before {
            content: "";
            position: absolute;
            left: 0;
            top: 10%;
            height: 80%;
            width: 3px;
            background: linear-gradient(#9c74ff, #c0a5ff);
            box-shadow: 0 0 15px #b48dff;
            border-radius: 2px;
        }

        /* è¾“å…¥æ¡†æ ·å¼è¦†ç›– */
        #login-screen .login-input {
            width: 100%;
            padding: 14px; /* å¢å¤§è§¦æ§åŒºåŸŸ */
            margin: 0 0 16px 0;
            border: none !important;
            border-radius: 8px;
            background: rgba(255,255,255,0.12) !important;
            color: #fff !important;
            outline: none;
            font-size: 16px; /* é˜²æ­¢iOSè¾“å…¥æ—¶è‡ªåŠ¨æ”¾å¤§ */
            box-sizing: border-box; /* ç¡®ä¿paddingä¸æ’‘å¤§å®½åº¦ */
        }
        
        #login-screen .login-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        /* æŒ‰é’®æ ·å¼è¦†ç›– */
        #login-screen .login-btn {
            width: 100%;
            padding: 14px;
            border: none;
            background: #9c74ff !important;
            color: white !important;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        #login-screen .login-btn:hover {
            background: #b48dff !important;
            box-shadow: 0 0 20px #b48dff;
            transform: translateY(-1px);
        }
        
        #login-screen .login-btn:active {
            transform: scale(0.98);
        }

        /* é’ˆå¯¹è¶…å°å±å¹•æ‰‹æœºçš„å¾®è°ƒ */
        @media (max-height: 600px) {
            .login-logo { width: 100px; height: 100px; margin-bottom: 10px; }
            .login-subtitle { margin-bottom: 15px; }
        }
    </style>
</head>
<body>

<div id="login-screen">
    <!-- è¯·ç¡®ä¿å°†ä½ çš„å›¾ç‰‡é‡å‘½åä¸º logo.png å¹¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæˆ–è€…ä¿®æ”¹ä¸‹æ–¹çš„ src -->
    <img src="logo.png" alt="é»å§å•¦AI" class="login-logo">

    <div class="login-title-text">Welcome to é»å§å•¦ AI Station</div>
    <div class="login-subtitle">å·¦è€³äº®äº†ï¼Œä½ çš„æ™ºæ…§ä¿¡å·å°±è¯¥ä¸Šçº¿äº†ã€‚</div>

    <div class="login-box">
        <!-- ä¿ç•™äº†åŸæœ‰IDä»¥ä¾¿ app.js è¯†åˆ« -->
        <input type="text" id="loginUser" class="login-input" placeholder="å†™ä¸Šä½ çš„ä»£å·ï¼Œé»å§å•¦åœ¨å¬ã€‚" autocomplete="off">
        <input type="password" id="loginPass" class="login-input" placeholder="å˜˜ï¼Œè¯´å°å£°ç‚¹ã€‚">
        
        <!-- ä¿ç•™åŸæœ‰ onclick äº‹ä»¶ -->
        <button class="login-btn" onclick="handleLogin()">è¿›å…¥ç«™ç‚¹</button>
        
        <!-- å·²åˆ é™¤åº•éƒ¨çš„â€œå¿˜è®°å¯†ç â€éƒ¨åˆ† -->
    </div>
</div>

<!-- å…¬å‘Šå¼¹çª— -->
<div id="announceModal" class="modal">
    <div class="modal-panel" style="max-width: 500px;">
        <div class="modal-header">
            <h3 style="margin:0; display:flex; align-items:center; gap:8px;">ğŸ“¢ ç«™ç‚¹å…¬å‘Š</h3>
            <button class="icon-btn" onclick="document.getElementById('announceModal').classList.remove('open')"><i data-lucide="x"></i></button>
        </div>
        <div id="announceBody" class="announce-content"></div>
        <div style="padding:16px; border-top:1px solid var(--border-color); text-align:right;">
             <button class="login-btn" style="width:auto; padding:8px 24px;" onclick="closeAnnouncement()">çŸ¥é“äº†</button>
        </div>
    </div>
</div>

<!-- ç®¡ç†åå° -->
<div id="adminModal" class="modal">
    <div class="modal-panel">
        <div class="modal-header">
            <h3 style="margin:0; display:flex; align-items:center; gap:8px;"><i data-lucide="settings-2"></i> ç®¡ç†åå°</h3>
            <button class="icon-btn" onclick="document.getElementById('adminModal').classList.remove('open')"><i data-lucide="x"></i></button>
        </div>
        <div class="admin-body" style="flex:1; overflow-y:auto; padding:24px;">
            
            <!-- æŠ˜å  1: å…¬å‘Šç®¡ç† -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this); fetchAdminAnnouncements();">
                    <span style="display:flex;align-items:center;gap:8px;"><i data-lucide="megaphone"></i> å…¬å‘Šç®¡ç†</span>
                    <i data-lucide="chevron-down"></i>
                </div>
                <div class="accordion-body">
                    <textarea id="announceInput" class="login-input" style="height:80px; resize:vertical; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="å‘å¸ƒæ–°å…¬å‘Š (è‡ªåŠ¨è¿½åŠ å½“å‰æ—¶é—´)"></textarea>
                    <div style="text-align:right; margin-bottom:16px;">
                        <button class="login-btn" style="width:auto; padding:8px 20px;" onclick="postAnnouncement()">å‘å¸ƒ</button>
                    </div>
                    <div style="border-top:1px solid var(--border-color); padding-top:12px;">
                        <div style="font-size:12px; font-weight:600; color:var(--text-secondary); margin-bottom:8px;">å†å²å…¬å‘Š</div>
                        <div id="adminAnnounceList" style="display:flex; flex-direction:column; gap:8px;"></div>
                    </div>
                </div>
            </div>

            <!-- æŠ˜å  2: æ•°æ®ç»Ÿè®¡ -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span style="display:flex;align-items:center;gap:8px;"><i data-lucide="bar-chart-3"></i> è°ƒç”¨ç»Ÿè®¡</span>
                    <i data-lucide="chevron-down"></i>
                </div>
                <div class="accordion-body">
                    <div id="statGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;"></div>
                </div>
            </div>
            
            <!-- æŠ˜å  3: æ¨¡å‹é¢„è®¾ -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span style="display:flex;align-items:center;gap:8px;"><i data-lucide="cpu"></i> æ¨¡å‹é¢„è®¾ç®¡ç†</span>
                    <i data-lucide="chevron-down"></i>
                </div>
                <div class="accordion-body">
                    <div id="adminPresetList" style="margin-bottom:16px; display:flex; flex-direction:column; gap:8px;"></div>
                    <div style="background:var(--bg-color); padding:16px; border-radius:8px; border:1px solid var(--border-color); margin-top:16px;">
                        <div style="font-weight:600; margin-bottom:12px; font-size:14px;" id="addFormTitle">æ·»åŠ æ–°é¢„è®¾</div>
                        <input type="hidden" id="addId">
                        <div style="display:grid; gap:12px;">
                            <input type="text" id="addName" class="login-input" style="margin:0; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="æ˜¾ç¤ºåç§°">
                            <input type="text" id="addDesc" class="login-input" style="margin:0; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="æè¿°">
                            <input type="text" id="addUrl" class="login-input" style="margin:0; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="API Base URL">
                            <input type="text" id="addKey" class="login-input" style="margin:0; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="API Key">
                            <input type="text" id="addModelId" class="login-input" style="margin:0; background:var(--bg-color)!important; color:var(--text-color)!important; border:1px solid var(--border-color)!important;" placeholder="Model ID">
                            <div style="display:flex; gap:12px;">
                                <button class="login-btn" style="flex:1;" onclick="savePreset()" id="savePresetBtn">ä¿å­˜é…ç½®</button>
                                <button class="btn-ghost" style="width:auto; padding:0 20px; border-radius:12px;" onclick="resetPresetForm()">é‡ç½®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align:center; margin-top:20px;">
                <button class="btn-danger sidebar-btn" onclick="forceMigrate()" style="justify-content:center;">
                    <i data-lucide="database-backup"></i> ä»æ—§æ•°æ®å¯¼å…¥
                </button>
            </div>
        </div>
    </div>
</div>

<div class="app-container" id="app">
    <div class="overlay" onclick="toggleSidebar()"></div>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢..." oninput="handleSearch(this.value)">
                <i data-lucide="search" class="search-icon"></i>
            </div>
            <div id="normalSidebarList" style="display:flex; flex-direction:column; gap:24px;">
                <div><div class="section-title">æ–°å¯¹è¯</div><div class="mode-list" id="presetList"></div></div>
                <div>
                    <div class="section-title" style="display:flex; justify-content:space-between;"><span>å†å²è®°å½•</span><span id="sessionCount" style="font-weight:normal;"></span></div>
                    <div id="sessionListContainer"></div>
                </div>
            </div>
            <div id="searchResultList" style="display:none;">
                <div class="section-title">æœç´¢ç»“æœ</div>
                <div id="searchOutput" style="display:flex; flex-direction:column; gap:4px;"></div>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="sidebar-btn btn-ghost" onclick="checkAnnouncement(true)"><i data-lucide="bell"></i> æŸ¥çœ‹å…¬å‘Š</button>
            <button id="adminBtn" onclick="openAdmin()" class="sidebar-btn btn-ghost" style="display:none;"><i data-lucide="settings"></i> è®¾ç½®</button>
            <button onclick="logout()" class="sidebar-btn btn-danger"><i data-lucide="log-out"></i> é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <div class="main-chat">
        <header class="chat-header">
            <div style="display:flex; align-items:center; gap:12px;">
                <button class="icon-btn" onclick="toggleSidebar()" style="color:var(--text-color);"><i data-lucide="menu"></i></button>
                <div style="font-weight:600; font-size:16px; display:flex; align-items:center; color:var(--text-color);">
                    <span style="width:8px; height:8px; background:#10b981; border-radius:50%; margin-right:8px; display:inline-block;"></span>
                    <span id="headerTitle">AI Chat</span>
                </div>
            </div>
            <div style="display:flex; gap:4px;">
                <button class="icon-btn" onclick="toggleTheme()"><i data-lucide="moon" id="themeIcon"></i></button>
            </div>
        </header>
        
        <div id="chat-box"></div>
        
        <div class="input-wrapper">
            <div id="preview-area"></div>
            <div class="input-box">
                <input type="file" id="fileInput" accept="image/*,.json,.txt,.js,.md,.csv,.py" multiple style="display:none;" onchange="handleFileSelect(this)">
                
                <button class="icon-btn" onclick="document.getElementById('fileInput').click()" title="ä¸Šä¼ æ–‡ä»¶" style="align-self:flex-end; margin-bottom:2px;">
                    <i data-lucide="paperclip"></i>
                </button>
                <!-- æ–°å¢ï¼šæœç´¢å¼€å…³ -->
                <button class="icon-btn" id="searchToggleBtn" onclick="toggleSearch()" title="å¼€å¯è”ç½‘æœç´¢" style="align-self:flex-end; margin-bottom:2px;">
                    <i data-lucide="globe"></i>
                </button>

                <textarea id="userInput" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1" oninput="autoResize(this)"></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    <i data-lucide="arrow-up"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<script src="app.js"></script>
</body>
</html>

